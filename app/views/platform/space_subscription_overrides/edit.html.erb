<div class="space-y-6">
  <header class="flex items-center justify-between gap-3">
    <div>
      <h1 class="text-2xl font-semibold tracking-tight text-slate-900">Subscription Override</h1>
      <p class="mt-1 text-sm text-slate-600">Manual billing overrides for <strong><%= @space.name %></strong>.</p>
    </div>
    <%= link_to "Back to Space", platform_space_path(@space),
                class: "inline-flex items-center rounded-md border border-slate-300 bg-white px-3 py-2 text-xs font-semibold text-slate-800 shadow-sm hover:bg-slate-50" %>
  </header>

  <%# Current subscription status %>
  <div class="rounded-xl border border-slate-200 bg-white p-5 shadow-sm">
    <h2 class="mb-3 text-sm font-semibold text-slate-800">Current Subscription</h2>
    <% if @subscription %>
      <dl class="grid gap-2 text-sm sm:grid-cols-3">
        <div>
          <dt class="text-xs text-slate-500">Plan</dt>
          <dd class="font-medium text-slate-900"><%= @subscription.plan_id.capitalize %></dd>
        </div>
        <div>
          <dt class="text-xs text-slate-500">Status</dt>
          <dd class="font-medium text-slate-900"><%= @subscription.status.humanize %></dd>
        </div>
        <div>
          <dt class="text-xs text-slate-500">Trial ends</dt>
          <dd class="font-medium text-slate-900"><%= @subscription.trial_ends_at&.to_date || "â€”" %></dd>
        </div>
      </dl>
    <% else %>
      <p class="text-sm text-slate-500">No subscription.</p>
    <% end %>
    <% if @credit %>
      <div class="mt-3 border-t border-slate-100 pt-3">
        <p class="text-xs text-slate-500">Credits: <strong><%= @credit.balance %></strong> purchased + <strong><%= @credit.monthly_quota_remaining %></strong> monthly quota</p>
      </div>
    <% end %>
  </div>

  <%# Extend trial %>
  <div class="rounded-xl border border-slate-200 bg-white p-5 shadow-sm">
    <h2 class="mb-3 text-sm font-semibold text-slate-800">Extend Trial</h2>
    <%= form_with url: platform_space_subscription_override_path(@space), method: :patch, class: "flex items-end gap-3" do |f| %>
      <%= hidden_field_tag :override_action, "extend_trial" %>
      <div>
        <%= label_tag :days, "Days to add", class: "block text-xs font-medium text-slate-700 mb-1" %>
        <%= number_field_tag :days, nil, min: 1, placeholder: "e.g. 14",
                             class: "rounded-md border border-slate-300 px-3 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500" %>
      </div>
      <button type="submit" class="rounded-lg bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700">
        Extend
      </button>
    <% end %>
  </div>

  <%# Change plan %>
  <div class="rounded-xl border border-slate-200 bg-white p-5 shadow-sm">
    <h2 class="mb-3 text-sm font-semibold text-slate-800">Change Plan</h2>
    <%= form_with url: platform_space_subscription_override_path(@space), method: :patch, class: "flex items-end gap-3" do |f| %>
      <%= hidden_field_tag :override_action, "change_plan" %>
      <div>
        <%= label_tag :plan_id, "Plan", class: "block text-xs font-medium text-slate-700 mb-1" %>
        <%= select_tag :plan_id, options_for_select(@plans.map { |p| [p.name, p.id] }, @subscription&.plan_id),
                       class: "rounded-md border border-slate-300 px-3 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500" %>
      </div>
      <button type="submit" class="rounded-lg bg-slate-900 px-4 py-2 text-sm font-medium text-white hover:bg-slate-800">
        Change
      </button>
    <% end %>
  </div>

  <%# Grant credits %>
  <div class="rounded-xl border border-slate-200 bg-white p-5 shadow-sm">
    <h2 class="mb-3 text-sm font-semibold text-slate-800">Grant Credits</h2>
    <%= form_with url: platform_space_subscription_override_path(@space), method: :patch, class: "flex items-end gap-3" do |f| %>
      <%= hidden_field_tag :override_action, "grant_credits" %>
      <div>
        <%= label_tag :amount, "Amount", class: "block text-xs font-medium text-slate-700 mb-1" %>
        <%= number_field_tag :amount, nil, min: 1, placeholder: "e.g. 100",
                             class: "rounded-md border border-slate-300 px-3 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500" %>
      </div>
      <button type="submit" class="rounded-lg bg-emerald-600 px-4 py-2 text-sm font-medium text-white hover:bg-emerald-700">
        Grant
      </button>
    <% end %>
  </div>
</div>
