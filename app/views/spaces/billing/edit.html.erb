<% content_for(:breadcrumbs) { render "shared/breadcrumbs", crumbs: [
  { label: t("breadcrumbs.dashboard"), path: root_path },
  { label: t("breadcrumbs.settings"), path: edit_settings_space_path },
  { label: t("breadcrumbs.billing"), path: settings_billing_path },
  { label: t("breadcrumbs.change_plan") }
] } %>
<% content_for(:settings_sidebar) do %>
  <%= render "shared/settings_sidebar" %>
<% end %>
<div class="space-y-4">
  <%= render "application/shared/page_header",
             title:   t("billing.edit.title"),
             subtitle: t("billing.edit.subtitle") %>

  <div class="grid gap-4 sm:grid-cols-3">
    <% @plans.each do |plan| %>
      <% is_current = @subscription&.billing_plan_id == plan.id %>
      <div class="relative flex flex-col rounded-xl border-2 <%= is_current ? 'border-slate-400 ring-2 ring-slate-100' : plan.highlighted? ? 'border-slate-700' : 'border-slate-200' %> bg-white p-5 shadow-sm">
        <%# Badges %>
        <div class="mb-2 flex flex-wrap gap-1.5 min-h-[1.5rem]">
          <% if plan.highlighted? %>
            <span class="inline-flex items-center rounded-full bg-slate-800 px-2.5 py-0.5 text-xs font-semibold text-white">
              ✦ <%= t("billing.edit.recommended") %>
            </span>
          <% end %>
          <% if is_current %>
            <span class="inline-flex items-center rounded-full bg-emerald-100 px-2.5 py-0.5 text-xs font-semibold text-emerald-700">
              <%= t("billing.edit.current") %>
            </span>
          <% end %>
        </div>

        <h2 class="text-lg font-semibold text-slate-900"><%= plan.name %></h2>

        <p class="mt-1 text-2xl font-bold text-slate-900">
          <%= plan.price_cents == 0 ? t("billing.edit.free") : number_to_currency(plan.price_cents / 100.0, unit: "R$", separator: ",", delimiter: ".") %>
          <span class="text-sm font-normal text-slate-500">/ <%= t("billing.edit.month") %></span>
        </p>

        <ul class="mt-4 flex-1 space-y-1.5 text-sm text-slate-700">
          <li>✓ <%= t("billing.edit.team_members", count: plan.max_team_members.nil? ? "∞" : plan.max_team_members) %></li>
          <li>✓ <%= t("billing.edit.customers_limit", count: plan.max_customers.nil? ? "∞" : plan.max_customers) %></li>
          <li>✓ <%= t("billing.edit.links_limit", count: plan.max_scheduling_links.nil? ? "∞" : plan.max_scheduling_links) %></li>
          <% if plan.feature?(:personalized_booking_page) %>
            <li>✓ <%= t("billing.edit.personalized_page") %></li>
          <% end %>
          <% if plan.feature?(:custom_appointment_policies) %>
            <li>✓ <%= t("billing.edit.custom_policies") %></li>
          <% end %>
          <% if plan.feature?(:priority_support) %>
            <li>✓ <%= t("billing.edit.priority_support") %></li>
          <% end %>
          <% if plan.whatsapp_monthly_quota.nil? %>
            <li>✓ <%= t("billing.edit.whatsapp_unlimited") %></li>
          <% elsif plan.whatsapp_monthly_quota > 0 %>
            <li>✓ <%= t("billing.edit.whatsapp_quota", count: plan.whatsapp_monthly_quota) %></li>
          <% end %>
        </ul>

        <div class="mt-4">
          <% if is_current %>
            <button type="button" disabled
                    class="w-full cursor-not-allowed rounded-lg border border-slate-200 bg-slate-50 px-4 py-2 text-sm font-medium text-slate-400">
              <%= t("billing.edit.current") %>
            </button>
          <% else %>
            <%= button_to t("billing.edit.select_plan"),
                          settings_billing_path,
                          method: :patch,
                          params: { billing_plan_id: plan.id },
                          class: "w-full #{button_classes(:primary)}" %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

</div>
