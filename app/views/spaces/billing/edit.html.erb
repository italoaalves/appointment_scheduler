<% content_for(:breadcrumbs) { render "shared/breadcrumbs", crumbs: [
  { label: t("breadcrumbs.dashboard"), path: root_path },
  { label: t("breadcrumbs.settings"), path: edit_settings_space_path },
  { label: t("breadcrumbs.billing"), path: settings_billing_path },
  { label: t("breadcrumbs.change_plan") }
] } %>
<% content_for(:settings_sidebar) do %>
  <%= render "shared/settings_sidebar" %>
<% end %>
<div class="space-y-4">
  <%= render "application/shared/page_header",
             title:   t("billing.edit.title"),
             subtitle: t("billing.edit.subtitle") %>

  <div class="grid gap-4 sm:grid-cols-2">
    <% @plans.each do |plan| %>
      <% is_current = @subscription&.plan_id == plan.slug %>
      <div class="rounded-xl border <%= is_current ? 'border-slate-400 ring-2 ring-slate-200' : 'border-slate-200' %> bg-white p-5 shadow-sm">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold text-slate-900"><%= plan.name %></h2>
          <% if is_current %>
            <span class="rounded-full bg-slate-100 px-2.5 py-0.5 text-xs font-medium text-slate-700">
              <%= t("billing.edit.current") %>
            </span>
          <% end %>
        </div>

        <p class="mt-2 text-2xl font-bold text-slate-900">
          <%= plan.price_cents == 0 ? t("billing.edit.free") : number_to_currency(plan.price_cents / 100.0, unit: "R$", separator: ",", delimiter: ".") %>
          <span class="text-sm font-normal text-slate-500">/ <%= t("billing.edit.month") %></span>
        </p>

        <ul class="mt-4 space-y-1.5 text-sm text-slate-700">
          <li>✓ <%= t("billing.edit.team_members", count: plan.max_team_members.nil? ? "∞" : plan.max_team_members) %></li>
          <li>✓ <%= t("billing.edit.customers_limit", count: plan.max_customers.nil? ? "∞" : plan.max_customers) %></li>
          <li>✓ <%= t("billing.edit.links_limit", count: plan.max_scheduling_links.nil? ? "∞" : plan.max_scheduling_links) %></li>
          <% if plan.feature?(:personalized_booking_page) %>
            <li>✓ <%= t("billing.edit.personalized_page") %></li>
          <% end %>
          <% if plan.feature?(:custom_appointment_policies) %>
            <li>✓ <%= t("billing.edit.custom_policies") %></li>
          <% end %>
          <% if plan.whatsapp_monthly_quota.to_i > 0 %>
            <li>✓ <%= t("billing.edit.whatsapp_quota", count: plan.whatsapp_monthly_quota) %></li>
          <% end %>
        </ul>

        <% unless is_current %>
          <div class="mt-4">
            <%= button_to t("billing.edit.select_plan"),
                          settings_billing_path,
                          method: :patch,
                          params: { plan_id: plan.slug },
                          class: "w-full #{button_classes(:primary)}" %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>

</div>
