<div class="mx-auto max-w-lg space-y-6">
  <header class="text-center">
    <div class="mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-emerald-500">
      <svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
      </svg>
    </div>
    <h1 class="text-2xl font-semibold tracking-tight text-slate-900">
      <%= t("booking.thank_you.title_new") %>
    </h1>
  </header>

  <% if @appointment.present? %>
    <% tz = timezone_for(@space) %>
    <% dt = @appointment.scheduled_at&.in_time_zone(tz) %>
    <% date_str = dt ? I18n.l(dt.to_date, format: :long) : "—" %>
    <% time_start = dt ? dt.strftime("%H:%M") : "—" %>
    <% time_end = dt ? (dt + @appointment.effective_duration_minutes.minutes).strftime("%H:%M") : "—" %>

    <div class="rounded-xl border border-slate-200 bg-white p-5 shadow-sm">
      <h2 class="text-lg font-semibold text-slate-900"><%= @space.name %></h2>
      <% if @space.business_type.present? %>
        <p class="mt-1 text-sm text-slate-600"><%= t("onboarding.step1.business_types.#{@space.business_type}", default: @space.business_type.humanize) %></p>
      <% end %>
      <dl class="mt-4 space-y-2">
        <div>
          <dt class="text-xs font-medium uppercase tracking-wide text-slate-500"><%= t("booking.thank_you.date") %></dt>
          <dd class="mt-0.5 text-sm text-slate-900"><%= date_str %></dd>
        </div>
        <div>
          <dt class="text-xs font-medium uppercase tracking-wide text-slate-500"><%= t("booking.thank_you.time") %></dt>
          <dd class="mt-0.5 text-sm text-slate-900"><%= time_start %> – <%= time_end %></dd>
        </div>
        <div>
          <dt class="text-xs font-medium uppercase tracking-wide text-slate-500"><%= t("booking.thank_you.duration") %></dt>
          <dd class="mt-0.5 text-sm text-slate-900"><%= t("booking.thank_you.duration_minutes", count: @appointment.effective_duration_minutes) %></dd>
        </div>
        <div>
          <dt class="text-xs font-medium uppercase tracking-wide text-slate-500"><%= t("booking.thank_you.status") %></dt>
          <dd class="mt-0.5">
            <span class="inline-flex items-center rounded-full bg-amber-100 px-2.5 py-0.5 text-xs font-medium text-amber-800">
              <%= t("booking.thank_you.status_pending") %>
            </span>
          </dd>
        </div>
      </dl>
    </div>

    <div class="flex flex-wrap gap-2">
      <%= link_to t("booking.thank_you.add_to_calendar"),
                  booking_calendar_ics_path(token: booking_calendar_token(@appointment)),
                  class: "inline-flex items-center rounded-md border border-slate-300 bg-white px-4 py-2 text-sm font-medium text-slate-700 shadow-sm hover:bg-slate-50",
                  download: "" %>
      <% google_calendar_url = @appointment.scheduled_at ? [
        "https://calendar.google.com/calendar/render",
        "?action=TEMPLATE",
        "&text=#{ERB::Util.url_encode("#{@space.name} — #{t("booking.calendar.summary_suffix")}")}",
        "&dates=#{@appointment.scheduled_at.utc.strftime("%Y%m%dT%H%M%SZ")}/#{(@appointment.scheduled_at + @appointment.effective_duration_minutes.minutes).utc.strftime("%Y%m%dT%H%M%SZ")}",
        @space.address.present? ? "&location=#{ERB::Util.url_encode(@space.address)}" : nil
      ].compact.join("").
      sub("&text=", "?text=") : nil %>
      <% if google_calendar_url.present? %>
        <a href="<%= google_calendar_url %>"
           target="_blank"
           rel="noopener noreferrer"
           class="inline-flex items-center rounded-md border border-slate-300 bg-white px-4 py-2 text-sm font-medium text-slate-700 shadow-sm hover:bg-slate-50">
          <%= t("booking.thank_you.add_to_google_calendar") %>
        </a>
      <% end %>
    </div>

    <p class="text-sm text-slate-600">
      <%= @space.booking_success_message.presence || t("booking.thank_you.default_message") %>
    </p>
  <% else %>
    <p class="text-center text-sm text-slate-600">
      <%= @space.booking_success_message.presence || t("booking.thank_you.default_message") %>
    </p>
  <% end %>
</div>
